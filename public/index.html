<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö - School Hub</title>
    <link rel="icon" href="icon.png" type="image/png">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root { --primary-color: #0d6efd; --secondary-color: #0dcaf0; }
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-card { border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; max-width: 500px; width: 100%; }
        .login-header { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); padding: 30px 20px; text-align: center; color: white; }
        .login-logo { max-width: 100px; height: auto; margin-bottom: 10px; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.2)); }
        .login-body { padding: 40px 30px; background: white; }
        .form-control, .form-select { border-radius: 10px; padding: 12px 15px; border: 1px solid #dee2e6; background-color: #f8f9fa; }
        .form-control:focus, .form-select:focus { background-color: white; box-shadow: none; border-color: var(--primary-color); }
        .btn-login { border-radius: 10px; padding: 12px; font-weight: 600; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border: none; transition: all 0.3s; }
        .btn-login:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(13, 110, 253, 0.3); }
        .btn-google { border-radius: 10px; padding: 12px; font-weight: 600; background: white; border: 2px solid #eee; color: #333; transition: all 0.3s; }
        .btn-google:hover { background: #f8f9fa; border-color: #ddd; }
        .divider { text-align: center; margin: 20px 0; position: relative; }
        .divider::before { content: ""; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: #eee; }
        .divider span { position: relative; background: white; padding: 0 15px; color: #999; font-size: 0.9rem; }
        .btn-register-link { text-decoration: none; color: var(--primary-color); font-weight: bold; cursor: pointer; }
        .btn-register-link:hover { text-decoration: underline; }
        
        /* Modal Styles */
        .role-section { display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 1px dashed #ced4da; }
        .modal-body { max-height: 75vh; overflow-y: auto; }
    </style>
</head>
<body>

    <div class="login-card">
        <div class="login-header">
            <img src="icon.png" alt="Logo" class="login-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3135/3135715.png'">
            <h3 class="fw-bold">School Hub</h3>
            <p class="mb-0 opacity-75">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</p>
        </div>
        <div class="login-body">
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label fw-bold">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <input type="email" id="email" class="form-control" placeholder="name@school.ac.th" required>
                </div>
                <div class="mb-4">
                    <label class="form-label fw-bold">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-login text-white">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
            </form>

            <div class="divider"><span>‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢</span></div>
            <div class="d-grid">
                <!-- üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô type="button" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô refresh -->
                <button id="googleLoginBtn" type="button" class="btn btn-google">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" width="20" class="me-2"> Google Account
                </button>
            </div>
            <div class="text-center mt-4 text-muted small">
                <p class="mb-0">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <span class="btn-register-link" data-bs-toggle="modal" data-bs-target="#registerModal">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</span></p>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Email/Pass) -->
    <div class="modal fade" id="registerModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title fw-bold"><i class="fa-solid fa-user-plus me-2"></i>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="regForm">
                        <!-- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö -->
                        <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (Account)</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• <span class="text-danger">*</span></label>
                                <input type="email" id="regEmail" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (6 ‡∏ï‡∏±‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ) <span class="text-danger">*</span></label>
                                <input type="password" id="regPassword" class="form-control" required minlength="6">
                            </div>
                        </div>

                        <!-- 2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß -->
                        <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (Personal Info)</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-3">
                                <label class="form-label">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                                <select id="regPrefix" class="form-select" required>
                                    <option value="" selected disabled>-</option>
                                    <option value="‡∏î.‡∏ä.">‡∏î.‡∏ä.</option>
                                    <option value="‡∏î.‡∏ç.">‡∏î.‡∏ç.</option>
                                    <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
                                    <option value="‡∏ô‡∏≤‡∏á">‡∏ô‡∏≤‡∏á</option>
                                    <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                                    <option value="Mr.">Mr.</option>
                                    <option value="Mrs.">Mrs.</option>
                                    <option value="Ms.">Ms.</option>
                                </select>
                            </div>
                            <div class="col-md-5">
                                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡πÑ‡∏ó‡∏¢) <span class="text-danger">*</span></label>
                                <input type="text" id="regName" class="form-control" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
                                <input type="text" id="regNickname" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î</label>
                                <input type="date" id="regDob" class="form-control">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
                                <input type="text" id="regNationalId" class="form-control" maxlength="13" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå <span class="text-danger">*</span></label>
                                <input type="tel" id="regPhone" class="form-control" required oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                            </div>
                        </div>

                        <!-- 3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) -->
                        <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö AI)</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-3">
                                <label class="form-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
                                <input type="number" id="regWeight" class="form-control" placeholder="0" min="0" step="0.1">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</label>
                                <input type="number" id="regHeight" class="form-control" placeholder="0" min="0">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß / ‡πÅ‡∏û‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                                <input type="text" id="regHealthInfo" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏≠‡∏ö‡∏´‡∏∑‡∏î, ‡πÅ‡∏û‡πâ‡∏ô‡∏°‡∏ß‡∏±‡∏ß (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á)">
                            </div>
                        </div>

                        <!-- 4. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó -->
                        <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">4. ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà (Role)</h6>
                        <div class="mb-3">
                            <label class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì <span class="text-danger">*</span></label>
                            <select id="regRole" class="form-select" onchange="toggleRoleFields('reg')" required>
                                <option value="" selected disabled>-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                                <option value="student">üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô / ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</option>
                                <option value="teacher_basic">üè´ ‡∏Ñ‡∏£‡∏π (‡∏õ‡∏£‡∏∞‡∏ñ‡∏°/‡∏°‡∏±‡∏ò‡∏¢‡∏°)</option>
                                <option value="teacher_kindergarten">üß∏ ‡∏Ñ‡∏£‡∏π (‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•)</option>
                                <option value="staff">üíº ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà / ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option>
                                <option value="executive">üëî ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)</option>
                                <option value="personnel">üìã ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>
                                <option value="technician">üõ†Ô∏è ‡∏ù‡πà‡∏≤‡∏¢‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</option>
                                <option value="transport">üöç ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</option>
                                <option value="security_guard">üõ°Ô∏è ‡∏£‡∏õ‡∏†.</option>
                            </select>
                        </div>

                        <!-- Dynamic Fields: ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
                        <div id="regStudentFields" class="role-section">
                            <h6 class="fw-bold text-info"><i class="fa-solid fa-graduation-cap"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h6>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                    <input type="text" id="regStudentId" class="form-control">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á</label>
                                    <select id="regStudentClass" class="form-select">
                                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>
                                        <!-- JS ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ -->
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
                                    <input type="number" id="regStudentNumber" class="form-control">
                                </div>
                                <div class="col-md-12">
                                    <label class="form-label">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                    <input type="text" id="regStudyProgram" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏ó‡∏¢‡πå-‡∏Ñ‡∏ì‡∏¥‡∏ï, ‡∏®‡∏¥‡∏•‡∏õ‡πå-‡∏†‡∏≤‡∏©‡∏≤">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
                                    <input type="text" id="regParentName" class="form-control">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
                                    <input type="tel" id="regParentPhone" class="form-control">
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic Fields: ‡∏Ñ‡∏£‡∏π -->
                        <div id="regTeacherFields" class="role-section">
                            <h6 class="fw-bold text-success"><i class="fa-solid fa-chalkboard-user"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏Ñ‡∏£‡∏π</h6>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏Ñ‡∏£‡∏π</label>
                                    <input type="text" id="regTeacherId" class="form-control">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</label>
                                    <select id="regTeacherPosition" class="form-select">
                                        <option value="‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢</option>
                                        <option value="‡∏Ñ‡∏£‡∏π">‡∏Ñ‡∏£‡∏π (‡∏Ñ‡∏®.1)</option>
                                        <option value="‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£">‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£ (‡∏Ñ‡∏®.2)</option>
                                        <option value="‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©">‡∏Ñ‡∏£‡∏π‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏Ñ‡∏®.3)</option>
                                        <option value="‡∏Ñ‡∏£‡∏π‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç">‡∏Ñ‡∏£‡∏π‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç (‡∏Ñ‡∏®.4)</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Ø</label>
                                    <select id="regTeacherDept" class="form-select">
                                        <option value="‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢">‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
                                        <option value="‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                                        <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø</option>
                                        <option value="‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ø</option>
                                        <option value="‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ø</option>
                                        <option value="‡∏®‡∏¥‡∏•‡∏õ‡∏∞">‡∏®‡∏¥‡∏•‡∏õ‡∏∞</option>
                                        <option value="‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û">‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option>
                                        <option value="‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®">‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</option>
                                        <option value="‡∏õ‡∏ê‡∏°‡∏ß‡∏±‡∏¢">‡∏õ‡∏ê‡∏°‡∏ß‡∏±‡∏¢</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic Fields: ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà -->
                        <div id="regStaffFields" class="role-section">
                            <h6 class="fw-bold text-warning"><i class="fa-solid fa-briefcase"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</label>
                                    <input type="text" id="regStaffPosition" class="form-control">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î/‡∏ù‡πà‡∏≤‡∏¢</label>
                                    <input type="text" id="regStaffDept" class="form-control">
                                </div>
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-success fw-bold py-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Google Register (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ) -->
    <div class="modal fade" id="googleRegisterModal" data-bs-backdrop="static" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title fw-bold"><i class="fa-brands fa-google me-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Google)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" id="btnCloseGoogleModal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="googleRegForm">
                        <input type="hidden" id="gRegEmail">
                        
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß -->
                        <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h6>
                        <div class="row g-3 mb-3">
                             <div class="col-md-3">
                                <label class="form-label">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                                <select id="gRegPrefix" class="form-select" required>
                                    <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
                                    <option value="‡∏ô‡∏≤‡∏á">‡∏ô‡∏≤‡∏á</option>
                                    <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                                    <option value="‡∏î.‡∏ä.">‡∏î.‡∏ä.</option>
                                    <option value="‡∏î.‡∏ç.">‡∏î.‡∏ç.</option>
                                </select>
                            </div>
                            <div class="col-md-5">
                                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="gRegName" class="form-control" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå <span class="text-danger">*</span></label>
                                <input type="tel" id="gRegPhone" class="form-control" required oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                            </div>
                        </div>

                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) -->
                        <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (Optional)</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <label class="form-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
                                <input type="number" id="gRegWeight" class="form-control" placeholder="0" min="0" step="0.1">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</label>
                                <input type="number" id="gRegHeight" class="form-control" placeholder="0" min="0">
                            </div>
                             <div class="col-md-4">
                                <label class="form-label">‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
                                <input type="text" id="gRegHealthInfo" class="form-control" placeholder="‡∏ñ‡πâ‡∏≤‡∏°‡∏µ">
                            </div>
                        </div>

                        <!-- ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó -->
                        <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">3. ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h6>
                        <div class="mb-3">
                            <select id="gRegRole" class="form-select" onchange="toggleRoleFields('google')" required>
                                <option value="" selected disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á --</option>
                                <option value="student">üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô / ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</option>
                                <option value="teacher_basic">üè´ ‡∏Ñ‡∏£‡∏π (‡∏õ‡∏£‡∏∞‡∏ñ‡∏°/‡∏°‡∏±‡∏ò‡∏¢‡∏°)</option>
                                <option value="teacher_kindergarten">üß∏ ‡∏Ñ‡∏£‡∏π (‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•)</option>
                                <option value="staff">üíº ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà / ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option>
                                <option value="executive">üëî ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)</option>
                                <option value="personnel">üìã ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>
                                <option value="technician">üõ†Ô∏è ‡∏ù‡πà‡∏≤‡∏¢‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</option>
                                <option value="transport">üöç ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</option>
                                <option value="security_guard">üõ°Ô∏è ‡∏£‡∏õ‡∏†.</option>
                            </select>
                        </div>

                        <!-- Dynamic Fields Google: Student -->
                        <div id="gRegStudentFields" class="role-section">
                            <h6 class="fw-bold text-info"><i class="fa-solid fa-graduation-cap"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á</label>
                                    <select id="gRegStudentClass" class="form-select">
                                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                    <input type="text" id="gRegStudentId" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dynamic Fields Google: Teacher (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) -->
                        <div id="gRegTeacherFields" class="role-section">
                            <h6 class="fw-bold text-success"><i class="fa-solid fa-chalkboard-user"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π</h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏Ñ‡∏£‡∏π</label>
                                    <input type="text" id="gRegTeacherId" class="form-control">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Ø</label>
                                    <select id="gRegTeacherDept" class="form-select">
                                        <option value="‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢">‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
                                        <option value="‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                                        <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø</option>
                                        <option value="‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ø</option>
                                        <option value="‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®">‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</option>
                                        <option value="‡∏õ‡∏ê‡∏°‡∏ß‡∏±‡∏¢">‡∏õ‡∏ê‡∏°‡∏ß‡∏±‡∏¢</option>
                                        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic Fields Google: Staff (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) -->
                        <div id="gRegStaffFields" class="role-section">
                            <h6 class="fw-bold text-warning"><i class="fa-solid fa-briefcase"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</label>
                                    <input type="text" id="gRegStaffPosition" class="form-control">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î/‡∏ù‡πà‡∏≤‡∏¢</label>
                                    <input type="text" id="gRegStaffDept" class="form-control">
                                </div>
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary fw-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut, createUserWithEmailAndPassword, sendEmailVerification, updatePassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDYqVJFyuge_4PcObIBMB9h5oIT3fYWuHM",
            authDomain: "school-management-system-10cbb.firebaseapp.com",
            projectId: "school-management-system-10cbb",
            storageBucket: "school-management-system-10cbb.firebasestorage.app",
            messagingSenderId: "674779385916",
            appId: "1:674779385916:web:9a26e4d25282dc23a6f339"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        let pendingGoogleUser = null;

        // Populate Classes (Updated list)
        const classList = [
            "‡∏õ.1/1", "‡∏õ.1/2", 
            "‡∏õ.2/1", 
            "‡∏õ.3/1", "‡∏õ.3/2", "‡∏õ.3/3", 
            "‡∏õ.4/1", "‡∏õ.4/2", "‡∏õ.4/3", 
            "‡∏õ.5/1", "‡∏õ.5/2", "‡∏õ.5/3", 
            "‡∏õ.6/1", "‡∏õ.6/2", 
            "‡∏°.1/1", "‡∏°.1/2", 
            "‡∏°.2/1", "‡∏°.2/2", 
            "‡∏°.3/1", "‡∏°.3/2", 
            "‡∏°.4/1", "‡∏°.4/2", 
            "‡∏°.5/1", "‡∏°.5/2", 
            "‡∏°.6/1", "‡∏°.6/2"
        ];
        function populateClasses() {
            const opts = classList.map(c => `<option value="${c}">${c}</option>`).join('');
            document.getElementById('regStudentClass').innerHTML += opts;
            document.getElementById('gRegStudentClass').innerHTML += opts;
        }
        populateClasses();

        // Toggle Fields Logic (Fixed to include Teacher/Staff for Google)
        window.toggleRoleFields = (type) => {
            const roleId = type === 'reg' ? 'regRole' : 'gRegRole';
            const role = document.getElementById(roleId).value;
            
            // Hide All First
            document.querySelectorAll(type === 'reg' ? '#regForm .role-section' : '#googleRegForm .role-section').forEach(el => el.style.display = 'none');

            // Show Specific
            if (role === 'student') {
                document.getElementById(type === 'reg' ? 'regStudentFields' : 'gRegStudentFields').style.display = 'block';
            } else if (role.startsWith('teacher')) {
                // Now supports Google Teacher Fields
                const el = document.getElementById(type === 'reg' ? 'regTeacherFields' : 'gRegTeacherFields'); 
                if(el) el.style.display = 'block';
            } else if (['staff', 'personnel', 'technician', 'transport', 'security_guard', 'executive'].includes(role)) {
                // Now supports Google Staff Fields
                const el = document.getElementById(type === 'reg' ? 'regStaffFields' : 'gRegStaffFields'); 
                if(el) el.style.display = 'block';
            }
        };

        async function checkUserInFirestore(user) {
            if (!user.emailVerified) {
                Swal.fire({
                    icon: 'warning', title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô',
                    text: `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏• ${user.email} ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô`,
                    confirmButtonText: '‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥'
                }).then(async (r) => {
                    if (r.isConfirmed) await sendEmailVerification(user);
                    await signOut(auth);
                });
                return;
            }

            const userDoc = await getDoc(doc(db, "users", user.uid));
            if (userDoc.exists()) {
                const d = userDoc.data();
                if (d.role === 'executive' && !d.approved) {
                    await signOut(auth);
                    Swal.fire('‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Admin', 'info');
                    return;
                }
                window.location.href = "dashboard.html";
            } else {
                const isGoogle = user.providerData.some(p => p.providerId === 'google.com');
                if (isGoogle) {
                    pendingGoogleUser = user;
                    document.getElementById('gRegEmail').value = user.email;
                    document.getElementById('gRegName').value = user.displayName;
                    new bootstrap.Modal(document.getElementById('googleRegisterModal')).show();
                } else {
                    await signOut(auth);
                    Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', 'error');
                }
            }
        }

        // --- Save Logic (‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ---
        async function saveUserData(uid, email, commonData, roleData) {
            const finalData = {
                email: email,
                firstName: commonData.name,
                prefix: commonData.prefix,
                nickname: commonData.nickname,
                dob: commonData.dob,
                nationalId: commonData.nationalId,
                phoneNumber: commonData.phone,
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (Health Data)
                weight: commonData.weight || '',
                height: commonData.height || '',
                healthInfo: commonData.healthInfo || '',
                
                role: commonData.role,
                approved: commonData.role !== 'executive', // Executive ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠
                emailVerified: true, 
                createdAt: serverTimestamp(),
                ...roleData 
            };
            await setDoc(doc(db, "users", uid), finalData);
        }

        // Register Submit
        document.getElementById('regForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            Swal.fire({title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£...', didOpen: () => Swal.showLoading()});
            
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPassword').value;
            const role = document.getElementById('regRole').value;

            // Collect Data
            const commonData = {
                name: document.getElementById('regName').value,
                prefix: document.getElementById('regPrefix').value,
                nickname: document.getElementById('regNickname').value,
                dob: document.getElementById('regDob').value,
                nationalId: document.getElementById('regNationalId').value,
                phone: document.getElementById('regPhone').value,
                // ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
                weight: document.getElementById('regWeight').value,
                height: document.getElementById('regHeight').value,
                healthInfo: document.getElementById('regHealthInfo').value,
                
                role: role
            };

            let roleData = {};
            if (role === 'student') {
                roleData = {
                    studentId: document.getElementById('regStudentId').value,
                    studentClass: document.getElementById('regStudentClass').value,
                    studentNumber: document.getElementById('regStudentNumber').value,
                    studyProgram: document.getElementById('regStudyProgram').value,
                    parentName: document.getElementById('regParentName').value,
                    parentPhone: document.getElementById('regParentPhone').value
                };
            } else if (role.startsWith('teacher')) {
                roleData = {
                    teacherId: document.getElementById('regTeacherId').value,
                    academicPosition: document.getElementById('regTeacherPosition').value,
                    department: document.getElementById('regTeacherDept').value
                };
            } else {
                roleData = {
                    position: document.getElementById('regStaffPosition').value,
                    department: document.getElementById('regStaffDept').value
                };
            }

            try {
                const uc = await createUserWithEmailAndPassword(auth, email, pass);
                await sendEmailVerification(uc.user);
                
                await saveUserData(uc.user.uid, email, commonData, roleData);
                
                await signOut(auth);
                bootstrap.Modal.getInstance(document.getElementById('registerModal')).hide();
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÉ‡∏´‡πâ', 'success');
            } catch (err) { Swal.fire('Error', err.message, 'error'); }
        });

        // Google Register Submit (Updated to handle new fields)
        document.getElementById('googleRegForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            Swal.fire({title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', didOpen: () => Swal.showLoading()});
            
            const role = document.getElementById('gRegRole').value;
            const commonData = {
                name: document.getElementById('gRegName').value,
                prefix: document.getElementById('gRegPrefix').value,
                phone: document.getElementById('gRegPhone').value,
                // ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û Google Form
                weight: document.getElementById('gRegWeight').value,
                height: document.getElementById('gRegHeight').value,
                healthInfo: document.getElementById('gRegHealthInfo').value,
                
                role: role,
                nickname: '', dob: '', nationalId: '' 
            };
            
            let roleData = {};
            if (role === 'student') {
                roleData = {
                    studentId: document.getElementById('gRegStudentId').value,
                    studentClass: document.getElementById('gRegStudentClass').value
                };
            } else if (role.startsWith('teacher')) {
                roleData = {
                    teacherId: document.getElementById('gRegTeacherId').value,
                    department: document.getElementById('gRegTeacherDept').value
                };
            } else {
                roleData = {
                    position: document.getElementById('gRegStaffPosition').value,
                    department: document.getElementById('gRegStaffDept').value
                };
            }

            try {
                await saveUserData(pendingGoogleUser.uid, pendingGoogleUser.email, commonData, roleData);
                if (role === 'executive') {
                    await signOut(auth);
                    Swal.fire('‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', '‡∏£‡∏≠ Admin ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö', 'info');
                } else {
                    window.location.href = "dashboard.html";
                }
            } catch (err) { Swal.fire('Error', err.message, 'error'); }
        });

        // Login Listeners
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try { const uc = await signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('password').value); checkUserInFirestore(uc.user); } 
            catch (error) { Swal.fire('Error', 'Login failed: ' + error.message, 'error'); }
        });
        document.getElementById('googleLoginBtn').addEventListener('click', async () => {
            try { const res = await signInWithPopup(auth, googleProvider); checkUserInFirestore(res.user); } 
            catch (error) { Swal.fire('Error', error.message, 'error'); }
        });
        document.getElementById('btnCloseGoogleModal').addEventListener('click', async () => await signOut(auth));

    </script>
</body>
</html>